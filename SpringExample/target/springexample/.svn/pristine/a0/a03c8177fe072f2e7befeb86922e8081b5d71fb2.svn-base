<%@ page language="java" contentType="text/html; charset=GBK"  pageEncoding="GBK"%>
<%@ page import="
java.util.HashMap,
java.util.ArrayList,
java.util.Iterator,
com.sohu.frontweb.flow.data.Triple,
com.sohu.frontweb.flow.action.XmlAction,
com.sohu.frontweb.ParameterWrapper,
java.net.URLDecoder,
java.net.URLEncoder
"
%> 
<%

		ParameterWrapper pw = new ParameterWrapper();
		pw.init(request);
		
		String title = pw.getStringParameter("title","");
		String startDate = pw.getStringParameter("sdate","201011220000");
		String endDate = pw.getStringParameter("edate","201011230000");
		String table = pw.getStringParameter("table","");
		
		ArrayList<String> columnList = new ArrayList<String>();
		columnList.add("title");
		columnList.add("date");
		columnList.add("c");
		
		String sqlStr = "select title,sum(count) as c,date from `"+ table +"` where date > ? and date < ? group by  title order by c desc limit 20";
		
		ArrayList valueList = new ArrayList();
		//whereList.add(new Triple("title","=",title));
		valueList.add(startDate);
		valueList.add(endDate);
		
		//whereList.add(new Triple("title","=",title));
		String pieDis = XmlAction.getPie(sqlStr,columnList,valueList);

%>


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=GBK"/>
	
</head>   
<body>

<table border=0 width=100% align="center" style="font-size:14px;text-align:center;margin-top:20px;">
<tr>	
</tr>
<tr>
		<td>
			<div id="pie_chartdiv"> </div>
		</td>
</tr>
</table>
<script type="text/javascript">

			
var pieDisXml = "<chart caption=\"·Ö²¼\" palette=\"2\" formatNumberScale='0' animation=\"1\" subCaption=\"\" YAxisName=\"\" showValues=\"1\" formatNumberScale=\"0\" showPercentInToolTip=\"1\" showLabels=\"1\" showLegend=\"0\" showPercentValues=\"1\">" +
				"<%=pieDis.toString()%>"+
				 "<styles><definition><style type=\"font\" name=\"CaptionFont\" color=\"666666\" size=\"15\" /><style type=\"font\" name=\"SubCaptionFont\" bold=\"0\" /></definition>" +
				 "<application><apply toObject=\"caption\" styles=\"CaptionFont\"/> <apply toObject=\"SubCaption\" styles=\"SubCaptionFont\" /></application>" +
				 "</styles></chart>";
		
	 
		   var chart = new FusionCharts("flash/FUSIONCHARTS.COM/Pie3D.swf", "ChartId1", "100%", "400", "0", "0");
		   chart.setXMLData(pieDisXml);
		   chart.render("pie_chartdiv");	 

</script>
</body>
</html>
