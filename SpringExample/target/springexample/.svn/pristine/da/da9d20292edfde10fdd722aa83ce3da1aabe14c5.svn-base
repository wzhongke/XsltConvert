<%@ page language="java" contentType="text/html; charset=GBK"  pageEncoding="GBK"%>
<%@ page import="
java.util.HashMap,
java.util.ArrayList,
java.util.Iterator,
com.sohu.frontweb.apollo.service.ApolloService,
com.sohu.frontweb.apollo.data.DataInfo,
com.sohu.frontweb.ParameterWrapper
"
%> 
<% 
	ParameterWrapper pw = new ParameterWrapper();
	pw.init(request);
	
	String act = pw.getStringParameter("act","basic");	
	String url = pw.getStringParameter("url","http://www.sogou.com/*");
	String type = pw.getStringParameter("type","prefix");
	
%>
  
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=GBK"/>
    <script language="JavaScript" src="js/chart/FusionCharts.js"></script>
<style>

#seachTable{font-size:16px;}
#mainDiv ul{}
#mainDiv ul li{float:left;margin:20px 20px 0px 0px;}
.chartDiv{margin-top:20px;}
</style>
</head>   
<script>

var p;
var today=new Date();
var yestoday = new Date(today.getTime() - 24*60*60*1000); 
var daysAgo = new Date(today.getTime() - 21*24*60*60*1000);

	Ext.namespace('Ext.exampledata');
	Ext.onReady(function(){
	
		/*****************************/		
		var dr = new Ext.FormPanel({
	    	labelWidth: 125,
	        frame: true,
	        width: 960,
	  	  	bodyStyle:'padding:5px 5px 0',
	        defaults: {width: 175},
	      	//增加表单键盘事件
	        keys:[
	         {
	             key: [10,13],
	             fn:searchInfo
	         } ],
	        items: [
	        	{
	        	xtype:'textfield',
				width : 400,
				id : 'url0',
				name : 'url0',
				fieldLabel:'URL',
				value:'<%=url%>'
	        	},
	        	<%if(act.equals("trend")){%>
	        	{
	        	xtype:'textfield',
				width : 400,
				id : 'url1',
				name : 'url1',
				fieldLabel:'VS',
				value:''
	        	},
	        	{
	        	xtype:'textfield',
				width : 400,
				id : 'url2',
				name : 'url2',
				fieldLabel:'VS',
				value:''
	        	},
	        	{
	        	xtype:'textfield',
				width : 400,
				id : 'url3',
				name : 'url3',
				fieldLabel:'VS',
				value:''
	        	},
	        	{
	        	xtype:'textfield',
				width : 400,
				id : 'url4',
				name : 'url4',
				fieldLabel:'VS',
				value:''
	        	},
	        	{
	        	xtype:'textfield',
				width : 400,
				id : 'url5',
				name : 'url5',
				fieldLabel:'VS',
				value:''
	        	},
	        	<%}%>

	        {
	            layout:'column',
	            width : 800,
	            border:false,
	            items:[
	                {
	                    columnWidth:.5,
	                    layout: 'form',
	                    border:false,
	                    items: [{
	                        xtype:'radio',
	                        fieldLabel:'类型',
	                        boxLabel:'前缀',
	                        checked: true,
	                        name:'type',
	                        anchor:'100%',
	                        inputValue: 'prefix'
	                    }]
	                },
	                {   
	                    columnWidth:.5,
	                    layout: 'form',
	                    border:false,
	                    items: [{
	                        xtype:'radio',
	                        boxLabel:'URL',
	                        hideLabel: true,
	                        name:'type',
	                        anchor:'100%',
	                        inputValue: 'url'
	                    }]
	                }
	              ]
            },
           	<%if(act.equals("trend")){%>
            {
        	    layout:'column',
        	    width : 620,
        	    border:false,
        	    items:[
        	        {
        	            columnWidth:.5,
        	            layout: 'form',
        	            border:false,
        	            items: [{
        	            	xtype:'textfield',
    						id : 'startDate',
    						name : 'startDate',
    						fieldLabel:'开始日期',
    						cls:'Wdate',
    						value:daysAgo.format('Ymd')
        	            }]
        	        }
        	      ]
        	}
        	,
        	<%}%>
        	{
        	    layout:'column',
        	    width : 620,
        	    border:false,
        	    items:[
        	        {
        	            columnWidth:.5,
        	            layout: 'form',
        	            border:false,
        	            items: [{
        	            	xtype:'textfield',
    						id : 'endDate',
    						name : 'endDate',
    						fieldLabel:'结束日期',
    						cls:'Wdate',
    						value:yestoday.format('Ymd')
        	            }]
        	        }
        	      ]
        	}
        	
        	],
			buttons:[
				{
					text : '查询',
					handler : function(){
						searchInfo();
					}
				},
				{
					text : '返回',
					handler : function(){
						searchInfo();
					}
				}
			]
	      });
		/**********************************************/		
	    dr.render('dr');
	        
	    p=new Ext.Panel({
		　　renderTo:"chart-div",//x,y,renderTo:Ext.getBody()初始化panel的位置
		　　autoWidth:true,
		   autoHeight:true
		}).show();//在这里也可以不show（）
	    
	   
	    searchInfo();

	    <%if(act.equals("trend")){%>
	    Ext.get('startDate').on('click',function(){
			WdatePicker({skin:'ext',dateFmt:'yyyyMMdd'});
		});
    	<%}%>
    	
    	Ext.get('endDate').on('click',function(){
			WdatePicker({skin:'ext',dateFmt:'yyyyMMdd'});
		});
		
		
function searchInfo(){
	var endDate = document.getElementById("endDate").value;
	
	var url_type;
	if(document.getElementsByName("type")[0].checked)
		url_type = "prefix";
	else
		url_type = "url";	
	
	
	<%if(act.equals("basic")){%>
		var searchUrl = 'apollo/basic.jsp?r='+Math.random();
		var url = escape(document.getElementById("url0").value);
		searchUrl += "&url="+url+"&date="+endDate+"&type="+url_type;
		
	<%}else if(act.equals("flow")){	
	%>
		var searchUrl = 'apollo/flow.jsp?r='+Math.random();
		var url = escape(document.getElementById("url0").value);
		searchUrl += "&url="+url+"&date="+endDate+"&type="+url_type;
	<%
	}else{%>
		var searchUrl = 'apollo/trend.jsp?r='+Math.random();
		var urls = "";
		var startDate = document.getElementById("startDate").value;
		for(var i = 0;i<6;i++){
			var url = document.getElementById("url"+i).value;
			if(!url)
				url = " ";
			urls += encodeURIComponent(url)+"|";
		}
		
		searchUrl += "&urls="+urls+"&startDate="+startDate+"&endDate="+endDate+"&type="+url_type;
	<%}%>
	
	p.load({
					url: searchUrl,
					callback : function(){
					},
					scripts: true
	});
	
	return false;
}		
	
	});

</script>
<body>
<div id="dr" style="width:100%;height:auto;"></div>
<div id='chart-div' style="width:100%; height:70%;"></div>

</body>

</html>

