<%@ page language="java" contentType="text/html; charset=GBK"
    pageEncoding="GBK"%>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=GBK">
	<title>域名表记录列表</title>
</head>
<script type="text/javascript">
	Ext.namespace('Ext.exampledata');
	Ext.exampledata.porn_level_list = [
		['0级', '0级', 'The Heart of Dixie'],
        ['1级', '1级', 'The Heart of Dixie'],
        ['2级', '2级', 'The Land of the Midnight Sun'],
        ['4级', '4级', 'The Grand Canyon State'],
        ['5级', '5级', 'The Land of the Midnight Sun'],
        ['9级', '6级', 'The Grand Canyon State']
    ];
	
	function getTimeAfterNow(after_mnt){ //当前日期后after_mnt分钟
		var clock = '';
	    var now = new Date();
	    now.setMinutes(now.getMinutes()+after_mnt);
	    
	    var yy = now.getFullYear(); 
	    var month = now.getMonth()+1;
	    var dd = now.getDate();

	    clock = yy + '-';
	    if (month < 10) clock += '0'; 
	    clock += month+'-'; 
	    if (dd < 10) clock += '0'; 
	    clock += dd+' '; 
	   
	   	/* 
	    var hh = now.getHours(); 
	    var mm = now.getMinutes(); 
	    var ss = now.getTime() % 60000; 
	    ss = (ss - (ss % 1000)) / 1000; 

	    if (hh < 10) clock += '0'; 
	    clock += hh+':'; 
	    if (mm < 10) clock += '0'; 
	    clock += mm+':'; 
	    if (ss < 10) clock += '0'; 
	    clock += ss; 
	    */
	    return(clock); 
	}	
	
	var store;
	function queryByDomain(domain){
			//新增域名表记录信息
			var query_keyword = "site:"+domain+" "+document.getElementById("query_keyword").value;			
			var url = "videoUIS.do?method=getPreviewList&query_keyword="+encodeURIComponent(query_keyword);
			//导出条件
			
			store.proxy.conn.url = url;
			store.load({params:{start:0, limit:16}});
	}
	
	
	Ext.onReady(function(){
		
		//创建新增或单独修改表记录信息的form表单
		Ext.QuickTips.init();
		Ext.form.Field.prototype.msgTarget = 'side';//统一指定错误信息提示方式
		//定义数据集对象
		store = new Ext.data.Store({//配置分组数据集
			reader: new Ext.data.XmlReader({
				totalRecords: "results",
				record: "FixedResult",
				id: "idStr"
			},
			Ext.data.Record.create([
				{name: 'idStr'},
				{name: 'sort'},
				{name: 'rank', type: 'int'},
				{name: 'title1'},
				{name: 'title2'},
				{name: 'surText'},
				{name: 'duration'},
				{name: 'picUrl'},
				{name: 'pageUrl'},
				{name: 'pageDomain'},
				{name: 'pageSite'},
				{name: 'operation'},
				{name: 'pagerank'},
				{name: 'modifyTime'}
			])
			),
			proxy : new Ext.data.HttpProxy({
				url : 'videoUIS.do?method=getPreviewList'
			}),
			sortInfo: {field: 'idStr', direction: 'DESC'},
	  		remoteSort: true
		})
		/*
		var store = new Ext.data.JsonStore({
	        url: 'videoUIS.do?method=getPreviewList',
	        root: 'images',
	        fields: ['name', 'url', {name:'size', type: 'float'}, {name:'lastmod', type:'date', dateFormat:'timestamp'}]
	    });*/


    	//创建分页工具栏
    	var pagingBar = new Ext.PagingToolbar({
	        pageSize: 16,
	        store: store,
	        displayInfo: true,
	        displayMsg: '显示 {0} - {1} , 共 {2} 条记录',
	        emptyMsg: "没有任何记录",
	        items:['-']
    	});
    	store.load({params:{start:0, limit:16}});
    	

    		      
		var tpl = new Ext.XTemplate(
			'<tpl for=".">',
				'<div class="thumb-wrap" id="{title1}">',
			    '<div class="videobox"><a target="_blank" href="{pageUrl}" onclick="window.open(\'{pageUrl}\') "><img src="{picUrl}" title="{title1}"></a></div>',
			    '<dl class="videoinfo">',
				'<dt>{[this.slice_title(values.title1,11*2,true)]}<dt>',
				'<dd>&nbsp;</dd>',
				'<dd>标签:{[this.slice_title(values.title2,9*2,true)]}</dd>',
				'<dd>时长:{[this.show_duration(values.duration)]} - {[this.slice_title(values.modifyTime,10,false)]}</dd>',
				'<dd>推荐指数: {[this.show_star(values.pagerank)]}</dd>',
				'<dd>仅显示 <a href="#" onclick=queryByDomain("{pageDomain}")>{pageSite}</a> 的搜索结果</dd>',
				'<tpl if="sort == 2">', 
	            '<dd style="background:#0000ff;width:35px;height:15px;text-align:center;"><font color="yellow" size="1">{rank+1}</font></dd>', 
	            '</tpl>',
				'<dd style="color:red">状态：{operation}</dd>', 
	            '</dl>',
			    '</div>',
	        '</tpl>',
	        '<div class="x-clear"></div>'
		);
		
		//显示时间
		tpl.show_duration = function(duration){
			var min = parseInt(duration/60);
			var sec = parseInt(duration%60);
			return min+"分"+sec+"秒";
		}
		//显示推荐指数
		tpl.show_star = function(pagerank){
			  var starcount = 0;
			  
			  var score = 0;
			  while(pagerank > 0){ 
					starcount++;
			  		if (pagerank >= 10){
			 	 		score += 1;
			 	 	}else{ 
						score += 0.5
			 	 	}
			  	 	pagerank -= 20;
			  }
			  return score;	
		}
		
		//字符串按字节截取函数
		tpl.slice_title = function(input, byteLength, ceil){
			var i = bL = 0;
	        while(bL < byteLength) 
	            bL += input.charCodeAt(i++) > 127 ? 2 : 1;
	        var end_point = bL > byteLength && ceil ? (i-1) : i;
	        if( end_point < input.length)
	        	input = input.slice(0,end_point) + "..."; 
	        return input; 
		}
		var dataview=  new Ext.DataView({
            store: store,
            tpl: tpl,
            autoHeight:true,
            multiSelect: true,
            overClass:'x-view-over',
            itemSelector:'div.thumb-wrap',
            emptyText: 'No images to display',

            plugins: [
                new Ext.DataView.DragSelector(),
                new Ext.DataView.LabelEditor({dataIndex: 'title1'})
            ],

            prepareData: function(data){
                data.shortName = Ext.util.Format.ellipsis(data.title_1, 15);
                //data.sizeString = Ext.util.Format.fileSize(data.size);
                //data.dateString = data.lastmod.format("m/d/Y g:i a");
                return data;
            },
            
            listeners: {
            	selectionchange: {
            		fn: function(dv,nodes){
            			var l = nodes.length;
            			var s = l != 1 ? 's' : '';
            			panel.setTitle('人工干预结果预览区域');
            		}
            	}
	        }
        });	
		 var panel = new Ext.Panel({
	        frame:true,
	        applyTo: 'images-view',
	        //width: 960,
	        autoWidth:true,
	        bodyStyle:'padding:5px 95px 5px 95px',
	        collapsible:true,
	        header:false,
	        autoScroll: true,
	        layout:'fit',
	        title:'人工干预结果预览区域',
	        tbar :[ 
	   	        {text : '新增',iconCls:'add',handler : showAdd},
	   	    	{text : '修改',iconCls:'option',handler : showModify},
	   	    	{text : '删除',iconCls:'remove',handler : showDelete},
	   	    	{text : '取消固排',iconCls:'remove',handler : showCancelFR},
	   	    	'-'
	   	    	,{text : '数据上线',iconCls:'option',handler : synchronize}
			],

	        items: dataview,
	        bbar: pagingBar
	    });


		//开始查询表单部分
		var dr = new Ext.FormPanel({
	    	labelWidth: 125,
	        frame: true,
	  	  	bodyStyle:'padding:5px 5px 0',
	  	  	width: 960,
	  	  	labelAlign: 'left',
	        defaults: {width: 175},
	      	//增加表单键盘事件
	        keys:[ { key: [10,13], fn:query } ],
	        items: [{xtype:'textfield',width : 400,id : 'query_keyword',name : 'query_keyword',fieldLabel:'关键词'}]
	      });
    	
		
    	var inputForm = new Ext.FormPanel({
			labelSeparator : ":",
			frame:true,
			border:false,
			autoHeight: true,
			width : 880,
			id : 'inputform',
			labelWidth : 60, 
			labelAlign  : 'right', 
			//增加表单键盘事件
			/*
	        keys:[
	         {
	             key: [10,13],
	             fn: function(k,e){
	             	var keyword1_val = Ext.getCmp("keyword1").getEl().dom.value;
	             	var url1_val = Ext.getCmp("url1").getEl().dom.value;
					loadForm( keyword1_val , url1_val );
				}
	         } ],*/
			items : [
				{
				    layout:'column',
				    width : 850,
				    border:false,
				    items:[
				            {
				                layout:'form',
				                columnWidth:.35,
				                border:false,
				                items:[ { xtype:'textfield', id : 'keyword1', name : 'keyword1', width : 230,  labelSeparator: '', fieldLabel:'查询词:<br>',
										enableKeyEvents : true,
										listeners:{
											change:{fn:function(txtcomp, eventobj ){
													loadForm(1);
											}}//change ends
										}				                
				                 } ]
				            },
				            {
				                layout:'form',
				                columnWidth:.65,
				                labelWidth : 70, 
				                border:false,
				                items:[ { xtype:'textfield', id : 'url1', name : 'url1', width : 440,  labelSeparator: '', fieldLabel:'页面URL:<br>',
										enableKeyEvents : true,
										listeners:{
											//keypress:{fn:function(txtcomp, eventobj ){Ext.getCmp('btn_submmit').disable();}},
											change:{fn:function(txtcomp, eventobj ){
													loadForm(1);
											}}//change ends
										}					                
				                 } ]
				            }
				    ]
				},{
				    layout:'column',
				    width : 850,
				    border:false,
				    items:[
				            {
				                layout:'form',
				                columnWidth:.35,
				                border:false,
				                items:[ { xtype:'textfield', id : 'title1', name : 'title1', width : 230,  labelSeparator: '', fieldLabel:'标题:<br>' } ]
				            },
				            {
				                layout:'form',
				                columnWidth:.47,
				                labelWidth : 70, 
				                border:false,
				                items:[ { xtype:'textfield', id : 'snap_url1', name : 'snap_url1', width : 315, labelSeparator: '', fieldLabel:'缩略图URL:<br>' } ]
				            },{
				                layout:'form',
				                columnWidth:.18,
				                border:false,
				                labelWidth : 40, 
				                items:[ { xtype:'textfield', id : 'duration1', name : 'duration1', width : 70,  labelSeparator: '', fieldLabel:'时长:' } ]
				            }
				        ]
				},{
				    layout:'column',
				    width : 850,
				    border:false,
				    items:[
				        {
			                layout:'form',
			                columnWidth:.35,
			                border:false,
			                items:[ { xtype:'textfield', id : 'sur_text1', name : 'sur_text1', width : 230,  labelSeparator: '', fieldLabel:'环绕文字:<br>' } ]
			            },{
			                layout:'form',
			                columnWidth:.3,
			                labelWidth : 70, 
			                border:false,
			                items:[ { xtype:'textfield', id : 'tag1', name : 'tag1', width : 170,  labelSeparator: '', fieldLabel:'标签:<br>' } ]
			            },{
			                layout:'form',
			                columnWidth:.18,
			                labelWidth : 40, 
			                border:false,
			                items:[ { xtype:'textfield', id : 'date1', name : 'date1', width : 95, fieldLabel:'日期', cls:'Wdate',value: getTimeAfterNow(0) } ]
			            },
			            {
			                layout:'form',
			                columnWidth:.03,
			                border:false,
			                labelWidth : 1, 
			                xtype:'hidden',
			                items:[ { xtype: 'checkbox', id: 'ranktag1', fieldLabel: '', checked: true, labelSeparator: '', boxLabel: '', inputValue: 0 }]
			            },
			            {
			                layout:'form',
			                columnWidth:.14,
			                border:false,
			                labelWidth : 40, 
			                items:[ { xtype:'textfield', id : 'ranknum1', name : 'ranknum1', width : 35, labelSeparator: '', fieldLabel:'固排:<br>',value:1 } ]
			            }
			        ]
				},{
					xtype:'hidden',
					id : 'id1',
					name : 'id1'
				},{
					id:'recordMore',
		            xtype:'fieldset',
		            title: '更多记录',
		            collapsible: true,
		            collapsed: true,
		            autoHeight:true,
		            items :[
				        /*第二条记录*/
						{
					    layout:'column',
					    width : 850,
					    border:false,
					    items:[
					            {
					                layout:'form',
					                columnWidth:.35,
					                border:false,
					                items:[ { xtype:'textfield', id : 'keyword2', name : 'keyword2', width : 230,  labelSeparator: '', fieldLabel:'查询词:<br>',
										enableKeyEvents : true,
										listeners:{
											change:{fn:function(txtcomp, eventobj ){
													loadForm(2);
											}}//change ends
										}						                	
					                 } ]
					            },
					            {
					                layout:'form',
					                columnWidth:.65,
					                labelWidth : 70, 
					                border:false,
					                items:[ { xtype:'textfield', id : 'url2', name : 'url2', width : 440,  labelSeparator: '', fieldLabel:'页面URL:<br>' ,
										enableKeyEvents : true,
										listeners:{
											change:{fn:function(txtcomp, eventobj ){
													loadForm(2);
											}}//change ends
										}						                
					                
					                } ]
					            }
						    ]
						},{
						    layout:'column',
						    width : 850,
						    border:false,
						    items:[
						            {
						                layout:'form',
						                columnWidth:.35,
						                border:false,
						                items:[ { xtype:'textfield', id : 'title2', name : 'title2', width : 230,  labelSeparator: '', fieldLabel:'标题:<br>' } ]
						            },
						            {
						                layout:'form',
						                columnWidth:.47,
						                labelWidth : 70, 
						                border:false,
						                items:[ { xtype:'textfield', id : 'snap_url2', name : 'snap_url2', width : 315, labelSeparator: '', fieldLabel:'缩略图URL:<br>' } ]
						            },{
						                layout:'form',
						                columnWidth:.18,
						                border:false,
						                labelWidth : 40, 
						                items:[ { xtype:'textfield', id : 'duration2', name : 'duration2', width : 70,  labelSeparator: '', fieldLabel:'时长:' } ]
						            }
						        ]
						},{
						    layout:'column',
						    width : 850,
						    border:false,
						    items:[
						        {
					                layout:'form',
					                columnWidth:.35,
					                border:false,
					                items:[ { xtype:'textfield', id : 'sur_text2', name : 'sur_text2', width : 230,  labelSeparator: '', fieldLabel:'环绕文字:<br>' } ]
					            },{
					                layout:'form',
					                columnWidth:.3,
					                labelWidth : 70, 
					                border:false,
					                items:[ { xtype:'textfield', id : 'tag2', name : 'tag2', width : 170,  labelSeparator: '', fieldLabel:'标签:<br>' } ]
					            },{
					                layout:'form',
					                columnWidth:.18,
					                labelWidth : 40, 
					                border:false,
					                items:[ { xtype:'textfield', id : 'date2', name : 'date2', width : 95, fieldLabel:'日期', cls:'Wdate',value: getTimeAfterNow(0) } ]
					            },
					            {
					                layout:'form',
					                columnWidth:.03,
					                border:false,
					                labelWidth : 1, 
					                xtype:'hidden',
					                items:[ { xtype: 'checkbox', id: 'ranktag2', fieldLabel: '', checked: true, labelSeparator: '', boxLabel: '', inputValue: 0 }]
					            },
					            {
					                layout:'form',
					                columnWidth:.14,
					                border:false,
					                labelWidth : 40, 
					                items:[ { xtype:'textfield', id : 'ranknum2', name : 'ranknum2', width : 35, labelSeparator: '', fieldLabel:'固排:<br>' } ]
					            }
					        ]
						},{
							xtype:'hidden',
							name : 'id2'
						},{
						    height: 15
						},
						/*第三条记录*/
						{
						    layout:'column',
						    width : 850,
						    border:false,
						    items:[
						            {
						                layout:'form',
						                columnWidth:.35,
						                border:false,
						                items:[ { xtype:'textfield', id : 'keyword3', name : 'keyword3', width : 230,  labelSeparator: '', fieldLabel:'查询词:<br>',
										enableKeyEvents : true,
										listeners:{
											change:{fn:function(txtcomp, eventobj ){
													loadForm(3);
											}}//change ends
										}							                					                
						                 } ]
						            },
						            {
						                layout:'form',
						                columnWidth:.65,
						                labelWidth : 70, 
						                border:false,
						                items:[ { xtype:'textfield', id : 'url3', name : 'url3', width : 440,  labelSeparator: '', fieldLabel:'页面URL:<br>',
										enableKeyEvents : true,
										listeners:{
											change:{fn:function(txtcomp, eventobj ){
													loadForm(3);
											}}//change ends
										}							                
						                
						                 } ]
						            }
						    ]
						},{
						    layout:'column',
						    width : 850,
						    border:false,
						    items:[
						            {
						                layout:'form',
						                columnWidth:.35,
						                border:false,
						                items:[ { xtype:'textfield', id : 'title3', name : 'title3', width : 230,  labelSeparator: '', fieldLabel:'标题:<br>' } ]
						            },
						            {
						                layout:'form',
						                columnWidth:.47,
						                labelWidth : 70, 
						                border:false,
						                items:[ { xtype:'textfield', id : 'snap_url3', name : 'snap_url3', width : 315, labelSeparator: '', fieldLabel:'缩略图URL:<br>' } ]
						            },{
						                layout:'form',
						                columnWidth:.18,
						                border:false,
						                labelWidth : 40, 
						                items:[ { xtype:'textfield', id : 'duration3', name : 'duration3', width : 70,  labelSeparator: '', fieldLabel:'时长:' } ]
						            }
						        ]
						},{
						    layout:'column',
						    width : 850,
						    border:false,
						    items:[
						        {
					                layout:'form',
					                columnWidth:.35,
					                border:false,
					                items:[ { xtype:'textfield', id : 'sur_text3', name : 'sur_text3', width : 230,  labelSeparator: '', fieldLabel:'环绕文字:<br>' } ]
					            },{
					                layout:'form',
					                columnWidth:.3,
					                labelWidth : 70, 
					                border:false,
					                items:[ { xtype:'textfield', id : 'tag3', name : 'tag3', width : 170,  labelSeparator: '', fieldLabel:'标签:<br>' } ]
					            },{
					                layout:'form',
					                columnWidth:.18,
					                labelWidth : 40, 
					                border:false,
					                items:[ { xtype:'textfield', id : 'date3', name : 'date3', width : 95, fieldLabel:'日期', cls:'Wdate',value: getTimeAfterNow(0) } ]
					            },
					            {
					                layout:'form',
					                columnWidth:.03,
					                border:false,
					                labelWidth : 1,
					                xtype:'hidden', 
					                items:[ { xtype: 'checkbox', id: 'ranktag3', fieldLabel: '', checked: true, labelSeparator: '', boxLabel: '', inputValue: 0 }]
					            },
					            {
					                layout:'form',
					                columnWidth:.14,
					                border:false,
					                labelWidth : 40, 
					                items:[ { xtype:'textfield', id : 'ranknum3', name : 'ranknum3', width : 35, labelSeparator: '', fieldLabel:'固排:<br>' } ]
					            }
					        ]
						},{
							xtype:'hidden',
							name : 'id3'
						},{
						    height: 15
						},
						/*第四条记录*/
						{
						    layout:'column',
						    width : 850,
						    border:false,
						    items:[
						            {
						                layout:'form',
						                columnWidth:.35,
						                border:false,
						                items:[ { xtype:'textfield', id : 'keyword4', name : 'keyword4', width : 230,  labelSeparator: '', fieldLabel:'查询词:<br>',
										enableKeyEvents : true,
										listeners:{
											change:{fn:function(txtcomp, eventobj ){
													loadForm(4);
											}}//change ends
										}							                
						                
						                 } ]
						            },
						            {
						                layout:'form',
						                columnWidth:.65,
						                labelWidth : 70, 
						                border:false,
						                items:[ { xtype:'textfield', id : 'url4', name : 'url4', width : 440,  labelSeparator: '', fieldLabel:'页面URL:<br>',
										enableKeyEvents : true,
										listeners:{
											change:{fn:function(txtcomp, eventobj ){
													loadForm(4);
											}}//change ends
										}							                
						                
						                 } ]
						            }
						    ]
						},{
						    layout:'column',
						    width : 850,
						    border:false,
						    items:[
						            {
						                layout:'form',
						                columnWidth:.35,
						                border:false,
						                items:[ { xtype:'textfield', id : 'title4', name : 'title4', width : 230,  labelSeparator: '', fieldLabel:'标题:<br>' } ]
						            },
						            {
						                layout:'form',
						                columnWidth:.47,
						                labelWidth : 70, 
						                border:false,
						                items:[ { xtype:'textfield', id : 'snap_url4', name : 'snap_url4', width : 315, labelSeparator: '', fieldLabel:'缩略图URL:<br>' } ]
						            },{
						                layout:'form',
						                columnWidth:.18,
						                border:false,
						                labelWidth : 40, 
						                items:[ { xtype:'textfield', id : 'duration4', name : 'duration4', width : 70,  labelSeparator: '', fieldLabel:'时长:' } ]
						            }
						        ]
						},{
						    layout:'column',
						    width : 850,
						    border:false,
						    items:[
						        {
					                layout:'form',
					                columnWidth:.35,
					                border:false,
					                items:[ { xtype:'textfield', id : 'sur_text4', name : 'sur_text4', width : 230,  labelSeparator: '', fieldLabel:'环绕文字:<br>' } ]
					            },{
					                layout:'form',
					                columnWidth:.3,
					                labelWidth : 70, 
					                border:false,
					                items:[ { xtype:'textfield', id : 'tag4', name : 'tag4', width : 170,  labelSeparator: '', fieldLabel:'标签:<br>' } ]
					            },{
					                layout:'form',
					                columnWidth:.18,
					                labelWidth : 40, 
					                border:false,
					                items:[ { xtype:'textfield', id : 'date4', name : 'date4', width : 95, fieldLabel:'日期', cls:'Wdate',value: getTimeAfterNow(0) } ]
					            },
					            {
					                layout:'form',
					                columnWidth:.03,
					                border:false,
					                labelWidth : 1, 
					                xtype:'hidden',
					                items:[ { xtype: 'checkbox', id: 'ranktag4', fieldLabel: '', checked: true, labelSeparator: '', boxLabel: '', inputValue: 0 }]
					            },
					            {
					                layout:'form',
					                columnWidth:.14,
					                border:false,
					                labelWidth : 40, 
					                items:[ { xtype:'textfield', id : 'ranknum4', name : 'ranknum4', width : 35, labelSeparator: '', fieldLabel:'固排:<br>' } ]
					            }
					        ]
						},{
							xtype:'hidden',
							name : 'id4'
						},{
						    height: 15
						},
						/*第五条记录*/
						{
						    layout:'column',
						    width : 850,
						    border:false,
						    items:[
						            {
						                layout:'form',
						                columnWidth:.35,
						                border:false,
						                items:[ { xtype:'textfield', id : 'keyword5', name : 'keyword5', width : 230,  labelSeparator: '', fieldLabel:'查询词:<br>',
										enableKeyEvents : true,
										listeners:{
											change:{fn:function(txtcomp, eventobj ){
													loadForm(5);
											}}//change ends
										}							                
						                
						                } ]
						            },
						            {
						                layout:'form',
						                columnWidth:.65,
						                labelWidth : 70, 
						                border:false,
						                items:[ { xtype:'textfield', id : 'url5', name : 'url5', width : 440,  labelSeparator: '', fieldLabel:'页面URL:<br>',
										enableKeyEvents : true,
										listeners:{
											change:{fn:function(txtcomp, eventobj ){
													loadForm(5);
											}}//change ends
										}							                
						                } ]
						            }
						    ]
						},{
						    layout:'column',
						    width : 850,
						    border:false,
						    items:[
						            {
						                layout:'form',
						                columnWidth:.35,
						                border:false,
						                items:[ { xtype:'textfield', id : 'title5', name : 'title5', width : 230,  labelSeparator: '', fieldLabel:'标题:<br>' } ]
						            },
						            {
						                layout:'form',
						                columnWidth:.47,
						                labelWidth : 70, 
						                border:false,
						                items:[ { xtype:'textfield', id : 'snap_url5', name : 'snap_url5', width : 315, labelSeparator: '', fieldLabel:'缩略图URL:<br>' } ]
						            },{
						                layout:'form',
						                columnWidth:.18,
						                border:false,
						                labelWidth : 40, 
						                items:[ { xtype:'textfield', id : 'duration5', name : 'duration5', width : 70,  labelSeparator: '', fieldLabel:'时长:' } ]
						            }
						        ]
						},{
						    layout:'column',
						    width : 850,
						    border:false,
						    items:[
						        {
					                layout:'form',
					                columnWidth:.35,
					                border:false,
					                items:[ { xtype:'textfield', id : 'sur_text5', name : 'sur_text5', width : 230,  labelSeparator: '', fieldLabel:'环绕文字:<br>' } ]
					            },{
					                layout:'form',
					                columnWidth:.3,
					                labelWidth : 70, 
					                border:false,
					                items:[ { xtype:'textfield', id : 'tag5', name : 'tag5', width : 170,  labelSeparator: '', fieldLabel:'标签:<br>' } ]
					            },{
					                layout:'form',
					                columnWidth:.18,
					                labelWidth : 40, 
					                border:false,
					                items:[ { xtype:'textfield', id : 'date5', name : 'date5', width : 95, fieldLabel:'日期', cls:'Wdate',value:getTimeAfterNow(0) } ]
					            },
					            {
					                layout:'form',
					                columnWidth:.03,
					                border:false,
					                labelWidth : 1, 
					                xtype:'hidden',
					                items:[ { xtype: 'checkbox', id: 'ranktag5', fieldLabel: '', checked: true, labelSeparator: '', boxLabel: '', inputValue: 0 }]
					            },
					            {
					                layout:'form',
					                columnWidth:.14,
					                border:false,
					                labelWidth : 40, 
					                items:[ { xtype:'textfield', id : 'ranknum5', name : 'ranknum5', width : 35, labelSeparator: '', fieldLabel:'固排:<br>' } ]
					            }
					        ]
						},{
							xtype:'hidden',
							name : 'id5'
						}
		            ]
		        }
			],
			buttons:[
				{
					text : '提交',
					handler : submitForm
				},
				{
					text : '关闭',
					handler : function(){
						win.hide();
					}
				}
			]
		});


		//删除原有窗口对象
		win = Ext.getCmp('input_window');
		if(win){
			win.destroy();
		}
		//创建弹出窗口
		var win = new Ext.Window({
			id: 'input_window',
			layout:'fit',
		    autoHeight:true,
		    width : 900,
		    closeAction:'hide',
			resizable : false,
			shadow : true,
			modal :true,
		    closable:true,
		    bodyStyle:'padding:5 5 5 5',
		    animCollapse:true,
			items:[inputForm]
		});
		win.width = 900;

		//显示新建域名表记录窗口
		function showAdd(){
			inputForm.form.reset();
			inputForm.isAdd = true;
			win.setTitle("新增记录信息");
			win.show();
			Ext.getCmp("recordMore").setVisible(true);
			bindingPicker();
			Ext.getCmp("keyword1").getEl().dom.value = document.getElementById("query_keyword").value ;
		}
		//显示修改域名表记录窗口
		function showModify(){
			var recs = dataview.getSelectedRecords();
			if(recs.length == 0){
				Ext.MessageBox.alert('提示','请选择要进行操作的记录！');
			}
			else if(recs.length > 1)
				Ext.MessageBox.alert("提示","每次只能修改一条记录信息。")
			else{
				//加载
				//alert(recs[0].get("title_1"));
				inputForm.form.reset();
				inputForm.isAdd = false;
				win.setTitle("修改记录信息");
				win.show();
				Ext.getCmp("recordMore").setVisible(false);
				
				Ext.getCmp("keyword1").getEl().dom.value = document.getElementById("query_keyword").value ;
             	Ext.getCmp("url1").getEl().dom.value = recs[0].get("pageUrl") ;
				Ext.getCmp("title1").getEl().dom.value = recs[0].get("title1") ;
				Ext.getCmp("tag1").getEl().dom.value = recs[0].get("title2") ;
				Ext.getCmp("snap_url1").getEl().dom.value = recs[0].get("picUrl") ;
				Ext.getCmp("sur_text1").getEl().dom.value = recs[0].get("surText") ;
				
				if(recs[0].get("idStr")!=""){
					Ext.getCmp("ranknum1").getEl().dom.value = recs[0].get("rank")+1 ;
				}
				
				Ext.getCmp("id1").getEl().dom.value = recs[0].get("idStr") ;
				
				//Ext.getCmp("tag1").getEl().dom.value = recs[0].get("tag1") ;
				Ext.getCmp("duration1").getEl().dom.value = recs[0].get("duration") ;
				Ext.getCmp("date1").getEl().dom.value = recs[0].get("modifyTime").substring(0,10) ;
			}
		}
		function bindingPicker(){
			Ext.get('date1').on('click',function(){
				WdatePicker({      skin:'ext',    dateFmt:'yyyy-MM-dd'    });
			});
			Ext.get('date2').on('click',function(){
				WdatePicker({      skin:'ext',    dateFmt:'yyyy-MM-dd'    });
			});
			Ext.get('date3').on('click',function(){
				WdatePicker({      skin:'ext',    dateFmt:'yyyy-MM-dd'    });
			});
			Ext.get('date4').on('click',function(){
				WdatePicker({      skin:'ext',    dateFmt:'yyyy-MM-dd'    });
			});
			Ext.get('date5').on('click',function(){
				WdatePicker({      skin:'ext',    dateFmt:'yyyy-MM-dd'    });
			});
		}
		//取消固排
		function showCancelFR(){
			var recordIdList = getCheckedIdList();

			if(recordIdList.length > 0){
				Ext.MessageBox.confirm("提示","您确定取消固排吗？",function(btnId){
					if(btnId == 'yes')
						cancelRecord(recordIdList);
				});
			}
		}
		
		function cancelRecord(recordIdList){
			var msgTip = Ext.MessageBox.show({
				title:'提示',
				width : 250,
				msg:'正在取消视频固排信息请稍后......'
			});
			Ext.Ajax.request({
				url : 'videoUIS.do?method=cancelRecord',
				params : {recordIdList : recordIdList.toString()},
				method : 'POST',
				success : function(response,options){
					msgTip.hide();
					var result = Ext.util.JSON.decode(response.responseText);
					if(result.success){
						//服务器端数据成功删除后，同步删除客户端列表中的数据
						store.load({params:{start:0, limit:18}});
						Ext.Msg.alert('提示','取消固排信息成功。');
					}else{
						Ext.Msg.alert('提示','取消固排信息失败');
					}
				},
				failure : function(response,options){
					msgTip.hide();
					Ext.Msg.alert('提示','取消固排信息失败！');
				}
			});			
		}
		
		//显示删除域名表记录对话框
		function showDelete(){
			var recs = dataview.getSelectedRecords();
			
			var list = [];
			if(recs.length == 0){
				Ext.MessageBox.alert('提示','请选择要进行操作的记录！');
				return;
			}else{
				for(var i = 0 ; i < recs.length ; i++){
					var rec = recs[i];
					var info = rec.get('idStr')+"|"+document.getElementById("query_keyword").value+"|"+rec.get('pageUrl');
					list.push(info);
				}
			}
			
			Ext.MessageBox.confirm("提示","您确定要删除所选记录吗？",function(btnId){
				if(btnId == 'yes'){
					deleteRecord(list.toString());
				}	
			});
		}
		//删除表记录
		function deleteRecord(recordIdList){
			var msgTip = Ext.MessageBox.show({
				title:'提示',
				width : 250,
				msg:'正在删除视频记录信息请稍后......'
			});
			Ext.Ajax.request({
				url : 'videoUIS.do?method=deleteRecord',
				params : {recordIdList : recordIdList.toString()},
				method : 'POST',
				success : function(response,options){
					msgTip.hide();
					var result = Ext.util.JSON.decode(response.responseText);
					if(result.success){
						//服务器端数据成功删除后，同步删除客户端列表中的数据
						store.load({params:{start:0, limit:18}});
						Ext.Msg.alert('提示','删除视频记录信息成功。');
					}else{
						Ext.Msg.alert('提示','删除视频干预信息失败！');
					}
				},
				failure : function(response,options){
					msgTip.hide();
					Ext.Msg.alert('提示','删除视频记录请求失败！');
				}
			});
		}
		
		function validateForm(){
			var MIN_TITLE_LEN = 1;
			var MAX_TITLE_LEN = 256;
			var MIN_TEXT_LEN = 1;
			var MAX_TEXT_LEN = 1024;			
			var URLREG = "^((https|http|ftp|rtsp|mms)?://)"; 
			var re=new RegExp(URLREG); 
			
			for(var i=1;i<6;i++){//.getEl().dom.value
			
				var keyword = Ext.getCmp('keyword'+i).getValue();
				var url = Ext.getCmp('url'+i).getValue();
				var title = Ext.getCmp('title'+i).getValue();
				var snapPic = Ext.getCmp('snap_url'+i).getValue();
				var duration = Ext.getCmp('duration'+i).getValue();
				var surText = Ext.getCmp('sur_text'+i).getValue();
				var tag = Ext.getCmp('tag'+i).getValue();	
				var rank = Ext.getCmp('ranknum'+i).getValue();		
				
				if(keyword=="" && url=="" && snapPic=="" && duration=="" && surText=="" && tag=="" && rank=="")
					continue;
				
				var msg="";
				if( keyword.length < MIN_TITLE_LEN ){
					msg += "关键词过短";
					break;
				}
				if( keyword.length > MAX_TITLE_LEN ){
					msg += "关键词过长";
					break;
				}
				if( rank <= 0 || (rank > 127 && rank != 255))
				{
		            msg += "排序值非法，必须是大于等于1而且小于等于127的数字，如果大于127必须等于255";
					break;
				}
				if( duration <= 0 || duration >= 30 * 24 * 3600 ) 
				{
					msg += "时长非法，必须是大于0而且小于30天的数字,单位：秒";
					break;
				}
				if( title.length < MIN_TITLE_LEN ) 
				{
					msg += "视频标题过短";
					break;
				}
				if( title.length > MAX_TITLE_LEN ) 
				{
					msg += "视频标题过长";
					break;
				}
				
				if(!re.test(snapPic)){
					msg += "缩略图地址不正确";
					break;
				}
				
				if(!snapPic){
					msg += "缩略图地址无效";
					break;
				}
				if( snapPic.length < MIN_TEXT_LEN ) 
				{
					msg += "缩略图地址过短";
					break;
				}
				if( snapPic.length > MAX_TEXT_LEN ) 
				{
					msg += "缩略图地址过长";
					break;
				}
		
				if(!re.test(url)){
					msg += "播放页地址不正确";
					break;
				}		
		
				if( url.length < MIN_TEXT_LEN ) 
				{
					msg += "播放页地址过短";
					break;
				}
				if( url.length > MAX_TEXT_LEN ) 
				{
					msg += "播放页地址过长";
					break;
				}								
			}
			
			if(msg!=""){
				Ext.MessageBox.alert('提示',"第"+i+"条记录"+msg);
				return false;
			}
			
			return true;
		}
		
		//提交表单数据
		function submitForm(){
			if(!validateForm())
				return; 
		
			//判断当前执行的提交操作，isAdd为true表示执行域名表记录新增操作，false表示执行域名表记录修改操作
			if( inputForm.form.isValid() ){
				if(inputForm.isAdd){
					//新增域名表记录信息
					inputForm.form.submit({
						clientValidation:true,//进行客户端验证
						waitMsg : '正在提交数据请稍后',//提示信息
						waitTitle : '提示',//标题
						url : 'videoUIS.do?method=addRecord',//请求的url地址
						method:'POST',//请求方式
						success:function(form,action){//加载成功的处理函数
							win.hide();
							var failcause = action.result.cause;
							Ext.MessageBox.show({
					           title: '提示',
					           msg: '完成新增视频干预记录操作。<br><br><br>' + failcause , 
					           buttons: Ext.MessageBox.OK,
					           icon: Ext.MessageBox.INFO
					        });
							store.load({params:{start:0, limit:18}});
						},
						failure:function(form,action){//加载失败的处理函数
							win.hide();
							var failcause = action.result.cause;
							Ext.MessageBox.show({
					           title: '提示',
					           msg: '新增视频干预记录失败。原因是:<br>'+failcause,
					           buttons: Ext.MessageBox.OK,
					           icon: Ext.MessageBox.ERROR
					        });
						}
					});
				}else{
					//修改域名表记录信息
					inputForm.form.submit({
						clientValidation:true,//进行客户端验证
						waitMsg : '正在提交数据请稍后',//提示信息
						waitTitle : '提示',//标题
						url : 'videoUIS.do?method=modifyRecord',//请求的url地址
						method:'POST',//请求方式
						success:function(form,action){//加载成功的处理函数
							win.hide();
							Ext.Msg.alert('提示','修改视频干预记录成功');
							store.load({params:{start:0, limit:18}});
						},
						failure:function(form,action){//加载失败的处理函数
							var failcause = action.result.cause;
							win.hide();
							Ext.MessageBox.show({
					           title: '提示',
					           msg: '修改视频干预记录失败。原因是:<br>'+failcause,
					           buttons: Ext.MessageBox.OK,
					           icon: Ext.MessageBox.ERROR
					        });
						}
					});
				}
			}//if( inputForm.form.isValid() )
		}
		//取得所选域名记录信息
		function getCheckedIdList(){
			var recs = dataview.getSelectedRecords();
			var list = [];
			
			if(recs.length == 0){
				Ext.MessageBox.alert('提示','请选择要进行操作的记录！');
			}else{
				for(var i = 0 ; i < recs.length ; i++){
					var rec = recs[i];
					if(rec.get('idStr')=="")
						continue;
					list.push(rec.get('idStr'));
				}
			}
			
			if(list.length == 0){
				Ext.MessageBox.alert('提示','请选择要有效的记录！');
			}
			
			return list; 		
		}
		//线上同步词表
		function synchronize(){
			var msgTip = Ext.MessageBox.show({
				title:'提示',
				width : 250,
				msg:'正在向线上发送数据，请稍候......'
			});
			Ext.Ajax.request({
				url : 'videoXml.do?method=syncData',
				//params : {deploytype : 'query'},
				method : 'GET',
				timeout :300000,
				success : function(response,options){
					msgTip.hide();
					var result = Ext.util.JSON.decode(response.responseText);
					if(result.success){
						//服务器端数据成功删除后，同步删除客户端列表中的数据
						store.load({params:{start:0, limit:18}});
						Ext.Msg.alert('提示','词表上线成功！');
					}else{
						Ext.Msg.alert('提示','词表上线失败！');
					}						
				},
				failure : function(response,options){
					msgTip.hide();
					Ext.Msg.alert('提示','词表线上同步失败！');
				}
			});
		}
		//加载已有数据
		function loadForm(index){
			var keyword = Ext.getCmp('keyword'+index).getValue();
			var url = Ext.getCmp('url'+index).getValue();
			if(keyword =="" || url == "")
				return;			
			if(inputForm.isAdd == false)
				return;
			
			var msgTip = Ext.MessageBox.show({
				title:'提示',
				width : 250,
				msg:'正在加载记录信息请稍候......'
			});
			Ext.Ajax.request({
				url : 'videoUIS.do?method=getRecordByKeyUrl',
				params : { keyword : keyword, url : url },
				method : 'POST',
				success : function(response,options){
					msgTip.hide();
					var result = Ext.util.JSON.decode(response.responseText);
					//给各字段绑定加载到的值
					if(result.data != null){
						if(result.data.title1)
							Ext.getCmp("title"+index).getEl().dom.value = result.data.title1 ;
						if(result.data.picUrl)
							Ext.getCmp("snap_url"+index).getEl().dom.value = result.data.picUrl ;
						if(result.data.surText)
							Ext.getCmp("sur_text"+index).getEl().dom.value = result.data.surText ;
						if(result.data.title2)
							Ext.getCmp("tag"+index).getEl().dom.value = result.data.title2 ;
						if(result.data.duration)
							Ext.getCmp("duration"+index).getEl().dom.value = result.data.duration ;
						if(result.data.rank)	
							Ext.getCmp("ranknum"+index).getEl().dom.value = result.data.rank ;
						if(result.data.idStr!="")
							Ext.getCmp("id"+index).getEl().dom.value = result.data.idStr ;	
						if(result.data.modifyTimeStr!="")
							Ext.getCmp("date"+index).getEl().dom.value = result.data.modifyTimeStr;							

					}else{
						Ext.getCmp("title"+index).getEl().dom.value = '' ;
						Ext.getCmp("snap_url"+index).getEl().dom.value = '' ;
						Ext.getCmp("sur_text"+index).getEl().dom.value = '' ;
						Ext.getCmp("tag"+index).getEl().dom.value = '' ;
						Ext.getCmp("duration"+index).getEl().dom.value = '' ;
					}
					
				}
			});
		}
		//导出Excel
		function exportExcel(){
			var msgTip = Ext.MessageBox.show({
				title:'提示',
				width : 250,
				msg:'正在导出网页hint记录信息请稍候（上限1w条）......'
			});
			Ext.Ajax.request({
				url : 'hint_webpage.do?method=exportRecord',
				params : {storeUrl : Ext.util.JSON.encode(exportConditionUrl) },
				method : 'POST',
				success : function(response,options){
					msgTip.hide();
					window.location = '<%=request.getContextPath()%>/blacklist_hint.xls';
					var result = Ext.util.JSON.decode(response.responseText);
				},
				failure : function(response,options){
					msgTip.hide();
					Ext.Msg.alert('提示','导出网页hint记录请求失败！');
				}
			});
			
		}
		//将 是否封禁首页和是否留首封站 的代码解析成 文本
		function booleantag(val){
	        if(val == 1){
	            return '是';
	        }else if(val == 0){
	            return '否';
	        }else
		        return '';
    	}
    	

		//开始查询代码
		function query(tag){
			//新增域名表记录信息
			var query_keyword ;
			if(tag)
				query_keyword = document.getElementById("query_keyword").value;
			else{
				query_keyword = '';
				document.getElementById("query_keyword").value='';
			}
			
			var url = "videoUIS.do?method=getPreviewList&query_keyword="+encodeURIComponent(query_keyword);
			//导出条件
			
			store.proxy.conn.url = url;
			store.load({params:{start:0, limit:16}});
		}
	    dr.render('dr');

	  	
	});
</script>
<body>
<div id="dr" style="width:100%;height:8%;"></div>
<div id='images-view' style="width:100%; height:92%;"></div>
</body>
</html>