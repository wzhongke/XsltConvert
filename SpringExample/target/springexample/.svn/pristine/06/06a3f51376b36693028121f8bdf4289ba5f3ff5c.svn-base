<%@ page language="java" contentType="text/html; charset=GBK" pageEncoding="GBK"%>
<%@ page import="com.sohu.frontweb.base.action.UmisAction"%>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=GBK">
    <title>域名表记录列表</title>
    <script type="text/javascript">
        tablename = "ubs_web_health_black_list";
        syncHubType = "other";
        pageSize = 18;
    </script>
    <script type="text/javascript" src="/js/quickSync.js"></script>
    <script type="text/javascript" src="/js/tabinsert.js"></script>
</head>
<script type="text/javascript">
    Ext.namespace('Ext.exampledata');
    Ext.exampledata.matchrule_list = [
        ['2','2级:模糊文字匹配', 'The Heart of Dixie'],
        ['3','3级:精确文字匹配', 'The Land of the Midnight Sun']
     ];
    Ext.onReady(function(){
        //创建新增或单独修改表记录信息的form表单
        Ext.QuickTips.init();
        Ext.form.Field.prototype.msgTarget = 'side';//统一指定错误信息提示方式

        var exportConditionUrl = 'mingyi_blacklist.do?method=getRecordList';

        //定义数据集对象
        var store = new Ext.data.Store({//配置分组数据集
            reader: new Ext.data.XmlReader({
                totalRecords: "results",
                record: "MingyiBlackListRecord",
                id: "id"
            },
            Ext.data.Record.create([
                {name: 'id'},
                {name: 'url'},
                {name: 'url_type'},
                {name: 'synchronized_tag'},
                {name: 'delay'},
                {name: 'sub_user'},
                <%if(UmisAction.UMIS_QUERY_USE_NEW_SYNC){%>
                {name: 'sub_date', type: 'date', dateFormat: 'Y-m-d H:i:s'},
                {name: 'sync_status'},
                {name: 'sync_message'},
                {name: 'sync_modify_time',type:'date',dateFormat:'Y-m-d H:i:s'},
                {name: 'info'}
                <%}else{%>
                {name: 'sub_date', type: 'date', dateFormat: 'Y-m-d H:i:s'}
                <%}%>
            ])
            ),
            proxy : new Ext.data.HttpProxy({
                url : 'mingyi_blacklist.do?method=getRecordList'
            }),
            sortInfo: {field: 'sub_date', direction: 'DESC'},
            remoteSort: true
        });

        <%//根据权限信息显示工具栏
        StringBuffer toolbar_str = new StringBuffer();
        toolbar_str.append("{text : '新增',iconCls:'add',handler : showAdd},");
        toolbar_str.append("{text : '修改',iconCls:'option',handler : showModify},");
        toolbar_str.append("{text : '删除',iconCls:'remove',handler : showDelete},");
        //toolbar_str.append("{text : '同步词表',iconCls:'batch-remove',handler : synchronize},");
        if(UmisAction.UMIS_QUERY_USE_NEW_SYNC){
            toolbar_str.append("{text : '快速同步new',iconCls:'batch-remove',handler : doSync},");
            toolbar_str.append("{text : '全量同步new',iconCls:'batch-remove',handler : doSyncAll},");
            toolbar_str.append("{text : '取消同步',iconCls:'batch-remove',handler : doCancel},");
        }
        toolbar_str.deleteCharAt(toolbar_str.length()-1);
        %>
        //创建工具栏组件
        var toolbar = new Ext.Toolbar([
            <%=toolbar_str.toString()%>
        ]);
        
        //创建分页工具栏
        var pagingBar = new Ext.PagingToolbar({
            pageSize: 18,
            store: store,
            displayInfo: true,
            displayMsg: '显示 {0} - {1} , 共 {2} 条记录',
            emptyMsg: "没有任何记录",
            items:[{text : '导出',iconCls:'option',handler : exportExcel}]
        });
        //创建Grid表格组件
        var cb = new Ext.grid.CheckboxSelectionModel();
        //创建过滤器
        var filters = new Ext.grid.GridFilters({
            filters:[
                {type: 'numeric',  dataIndex: 'id'},
                {type: 'string',  dataIndex: 'url'},
                {type: 'boolean', dataIndex: 'tag_block'},
                {type: 'boolean', dataIndex: 'tag_reversible'},
                {
                   type: 'list',
                    dataIndex: 'extra_attr',
                    options: ['无价值', '死链', '非中文'],
                    phpMode: true
                },
                {type: 'string',  dataIndex: 'delay'},
                {type: 'string',  dataIndex: 'user'},
                {type: 'date',  dataIndex: 'sub_date'},
                {type: 'string',  dataIndex: 'info'}
            ]
        });

        var dr = new Ext.FormPanel({
            labelWidth: 125,
            frame: true,
            width: 960,
            bodyStyle:'padding:5px 5px 0',
            defaults: {width: 175},
            //增加表单键盘事件
            keys:[
             {
                 key: [10,13],
                 fn:query
             } ],
            items: [{
                xtype:'textfield',
                width : 400,
                id : 'query_url',
                name : 'query_url',
                fieldLabel:'URL'
            },

            {
                layout:'column',
                width : 800,
                border:false,
                items:[
                    {
                        columnWidth:.5,
                        layout: 'form',
                        border:false,
                        items: [{
                            xtype:'radio',
                            fieldLabel:'查找方式',
                            boxLabel:'精确查找',
                            name:'query_matchType',
                            anchor:'100%',
                            inputValue: 1
                        }]
                    },
                    {   
                        columnWidth:.5,
                        layout: 'form',
                        border:false,
                        items: [{
                            xtype:'radio',
                            boxLabel:'模糊查找',
                            checked: true,
                            hideLabel: true,
                            name:'query_matchType',
                            anchor:'100%',
                            inputValue: 0
                        }]
                    }
                  ]
            },
            {
                xtype:'textfield',
                width : 400,
                id : 'query_info',
                name : 'query_info',
                fieldLabel:'备注'
            },

            {
                layout:'column',
                width : 800,
                border:false,
                items:[
                    {
                        columnWidth:.5,
                        layout: 'form',
                        border:false,
                        items: [{
                            xtype:'radio',
                            fieldLabel:'查找方式',
                            boxLabel:'精确查找',
                            name:'query_info_type',
                            anchor:'100%',
                            inputValue: 1
                        }]
                    },
                    {   
                        columnWidth:.5,
                        layout: 'form',
                        border:false,
                        items: [{
                            xtype:'radio',
                            boxLabel:'模糊查找',
                            checked: true,
                            hideLabel: true,
                            name:'query_info_type',
                            anchor:'100%',
                            inputValue: 0
                        }]
                    }
                  ]
            },
            {
                layout:'column',
                width : 620,
                border:false,
                items:[
                    {
                        columnWidth:.5,
                        layout: 'form',
                        border:false,
                        items: [{
                            xtype:'textfield',
                            id : 'query_create_time_1',
                            name : 'query_create_time_1',
                            fieldLabel:'提交日期',
                            cls:'Wdate'
                        }]
                    },
                    {
                        columnWidth:.5,
                        layout: 'form',
                        border:false,
                        items: [{
                            xtype:'textfield',
                            id : 'query_create_time_2',
                            name : 'query_create_time_2',
                            fieldLabel:'到',
                            cls:'Wdate'
                        }]
                    }
                  ]
            },
            {
                layout:'column',
                width : 930,
                border:false,
                items:[
                        {
                            layout:'form',
                            columnWidth:.35,
                            border:false,
                            items:[
                                    {
                                        xtype:'textfield',
                                        id : 'query_sub_user',
                                        name : 'query_sub_user',
                                        fieldLabel:'提交人'
                                    }
                                ]
                        },{
                            layout:'column',
                            columnWidth:.65,
                            border:false,
                            items:[
                                    {
                                        columnWidth:.5,
                                        layout: 'form',
                                        border:false,
                                        items: [{
                                            xtype: 'radio',
                                            fieldLabel: 'URL类别:',
                                            labelSeparator: '',
                                            checked : true,
                                            labelStyle: 'width: 85px;',
                                            boxLabel: '全部',
                                            name: 'query_url_type',
                                            inputValue: -100
                                        }]
                                    },
                                    {   
                                        columnWidth:.25,
                                        layout: 'form',
                                        border:false,
                                        items: [{
                                            xtype: 'radio',
                                            fieldLabel: '',
                                            hideLabel: true,
                                            labelSeparator: '',
                                            boxLabel: 'Url',
                                            name: 'query_url_type',
                                            inputValue: 0
                                        }]
                                    },
                                    {   
                                        columnWidth:.25,
                                        layout: 'form',
                                        border:false,
                                        items: [{
                                            xtype: 'radio',
                                            fieldLabel: '',
                                            hideLabel: true,
                                            labelSeparator: '',
                                            boxLabel: 'Site',
                                            name: 'query_url_type',
                                            inputValue: 1
                                        }]
                                    },{   
                                        columnWidth:.25,
                                        layout: 'form',
                                        border:false,
                                        items: [{
                                            xtype: 'radio',
                                            fieldLabel: '',
                                            hideLabel: true,
                                            labelSeparator: '',
                                            boxLabel: 'Domain',
                                            name: 'query_url_type',
                                            inputValue: 2
                                        }]
                                    },{   
                                        columnWidth:.25,
                                        layout: 'form',
                                        border:false,
                                        items: [{
                                            xtype: 'radio',
                                            fieldLabel: '',
                                            hideLabel: true,
                                            labelSeparator: '',
                                            boxLabel: 'Prefix',
                                            name: 'query_url_type',
                                            inputValue: 3
                                        }]
                                    }
                              ]
                        }
                    ]
            }],
            buttons:[
                {
                    text : '查询',
                    handler : function(){
                        query(true);
                    }
                },
                {
                    text : '返回',
                    handler : function(){
                        query(false);
                    }
                }
            ]
          });
 
        var recordGrid = new Ext.grid.GridPanel({
            applyTo : 'grid-div',
            tbar : toolbar,
            frame:true,
            loadMask: true,
            //plugins: filters,
            autoScroll: true,
            //width: 960,
            autoWidth:true,
            store: store,
            viewConfig : {
                autoFill : true
            },
            sm : cb,
            columns: [//配置表格列
                new Ext.grid.RowNumberer({
                    header : '行号',
                    width : 40
                }),//表格行号组件
                cb,
                {header: "编号", width: 30, dataIndex: 'id', sortable: true},
                {header: "同步状态", width: 30, dataIndex: 'synchronized_tag', sortable: true},
                {header: "URL", width: 200, dataIndex: 'url', sortable: true},
                {header: "URL类型", width: 30, dataIndex: 'url_type', renderer:urltype, sortable: true},
                {header: "是否推迟上线", width: 50, dataIndex: 'delay'},
                {header: "提交者", width: 75, dataIndex: 'sub_user', sortable: true},
                <%if(UmisAction.UMIS_QUERY_USE_NEW_SYNC){%>
                {header: "提交日期", width: 75, dataIndex: 'sub_date', renderer: Ext.util.Format.dateRenderer('Y-m-d H:i:s'), sortable: true},
                {header: "快速同步状态", width: 75, dataIndex: 'sync_status',sortable: true,renderer:function(value,cellmeta,record){                  
                    if(value==1){cellmeta.attr="style=background-color:red";return "新增";}
                    if(value==2){cellmeta.attr="style=background-color:yellow";return "待同步";}
                    if(value==3){
                        var sync_modify_time = record.data['sync_modify_time'];
                        cellmeta.attr="style=background-color:yellow";
                        return "同步中";}
                    if(value==4){cellmeta.attr="style=background-color:green";return "同步成功";}
                    if(value==5){cellmeta.attr="style=background-color:red";return "同步失败";}
                    
                    var sync_modify_time = record.data['sync_modify_time'];
                    //return Ext.util.Format.date(sync_modify_time, 'Y-m-d H:i:s');
                    cellmeta.attr="style=background-color:red";
                    return "数据错误";}},
                {header: "同步信息", width: 75, dataIndex: 'sync_message'},
                {header: "同步修改时间", width: 75, dataIndex: 'sync_modify_time', renderer: Ext.util.Format.dateRenderer('Y-m-d H:i:s')},
                {header: "备注", width: 200, dataIndex: 'info', sortable: true}
                <%}else{%>
                {header: "提交日期", width: 75, dataIndex: 'sub_date', renderer: Ext.util.Format.dateRenderer('Y-m-d H:i:s'), sortable: true}
                <%}%>
            ],
            // paging bar on the bottom
            bbar: pagingBar
            
        });
        // trigger the data store load
        store.load({params:{start:0, limit:18}});


        
        
        var inputForm = new Ext.FormPanel({
            labelSeparator : ":",
            frame:true,
            border:false,
            autoHeight: true,
            id : 'inputform',
            items : [
                {
                    xtype:'textarea',
                    width : 600,
                    height : 150,
                    id:'inputUrl',
                    name : 'url',
                    fieldLabel:'<font color=red>*</font>URL<br><font color=red>（每条长度超过4096为不合法）</font>',
                    allowBlank : false
                    <%if((Integer)session.getAttribute("query_webpage_alldata")==null || (Integer)session.getAttribute("query_webpage_alldata") !=1){%>
//                    ,
//                    regex       : /^(?!([\s\S]*)?#)([\s\S]*)$/,
//                    regexText   : "URL中不能包含#号！"
                    <%}%>
                },{        
                    xtype:'textfield',
                      width : 600,
                      allowBlank : true,
                      id : 'info',
                      name : 'info',
                      fieldLabel:'备注',
                      value: ''                
              },{
                    xtype: 'radiogroup',
                    fieldLabel: '<font color=red>*</font>URL类型:',
                    columns:4,
                    labelSeparator: '',
                    id:'url_type',
                    items:[
                           {checked: true,boxLabel: 'Url',name: 'url_type',inputValue: 0},
                           {boxLabel: 'Site',name: 'url_type',inputValue: 1},
                           {boxLabel: 'Domain',name: 'url_type',inputValue: 2},
                           {boxLabel: 'Prefix',name: 'url_type',inputValue: 3}
                           ]                    
                },
                {
                    xtype: 'radiogroup',
                    fieldLabel: '<font color=red>*</font>是否推迟上线:',
                    labelSeparator: '',
                    hideLabel :true,
                    columns:2,
                    items:[
                           {checked: false,boxLabel: '是',name: 'delay',inputValue: 1,hideLabel :true,hidden :true},
                           {checked: true,boxLabel: '否',name: 'delay',inputValue: 0,hideLabel :true,hidden :true}
                           ]    
                },
                
                {
                    xtype:'hidden',
                    name : 'id'
                }
            ],
            buttons:[
                {
                    text : '提交',
                    handler : submitForm
                },
                {
                    text : '关闭',
                    handler : function(){
                        win.hide();
                    }
                }
            ]
        });

        //删除原有窗口对象
        win = Ext.getCmp('input_window');
        if(win){
            win.destroy();
        }
        
        //创建弹出窗口
        var win = new Ext.Window({
            id: 'input_window',
            layout:'fit',
            width:800,
            closeAction:'hide',
            resizable : false,
            shadow : true,
            modal :true,
            closable:true,
            bodyStyle:'padding:5 5 5 5',
            animCollapse:true,
            items:[inputForm]
        });
        win.width = 800;
        win.height = 350;


        //显示新建域名表记录窗口
        function showAdd(){
            inputForm.form.reset();
            inputForm.isAdd = true;
            win.setTitle("新增记录信息");
            win.show();
        }
        //显示修改域名表记录窗口
        function showModify(){
            var recordList = getCheckedIdList();
            var num = recordList.length;
            if(num > 1){
                Ext.MessageBox.alert("提示","每次只能修改一条记录信息。")
            }else if(num == 1){
                inputForm.isAdd = false;
                win.setTitle("修改记录信息");
                win.show();
                var recordId = recordList[0];
                loadForm(recordId);
            }
        }
        function reload(){
            store.load({params:{start:0, limit:pageSize}});
        }
        function doSync(){
            new_synchronize(reload);
        }
        function doSyncAll(){
            new_synchronize_all(reload);
        }
        function doCancel(){
            cancel_synchronize(reload);
        }
        
        //加载表单数据
        function loadForm(recordId){
            inputForm.form.load({
                waitMsg : '正在加载数据请稍候...',//提示信息
                waitTitle : '提示',//标题
                url : 'mingyi_blacklist.do?method=getRecordById',//请求的url地址
                params : {recordId : recordId},
                method:'GET',//请求方式
                success:function(form,action){//加载成功的处理函数
                },
                failure:function(form,action){//加载失败的处理函数
                    Ext.Msg.alert('提示','数据加载失败');
                }
            });
        }
        //显示删除域名表记录对话框
        function showDelete(){
            var recordIdList = getCheckedIdList();
            var num = recordIdList.length;
            if(num == 0){
                return;
            }
            Ext.MessageBox.confirm("提示","您确定要删除所选记录吗？",function(btnId){
                if(btnId == 'yes')
                    deleteRecord(recordIdList);
            })
        }
        //删除域名表记录
        function deleteRecord(recordIdList){
            var msgTip = Ext.MessageBox.show({
                title:'提示',
                width : 250,
                msg:'正在删除网页query表记录信息请稍后......'
            });
            Ext.Ajax.request({
                url : 'mingyi_blacklist.do?method=deleteRecord',
                params : {recordIdList : recordIdList.toString()},
                method : 'POST',
                success : function(response,options){
                    msgTip.hide();
                    var result = Ext.util.JSON.decode(response.responseText);
                    if(result.success){
                        //服务器端数据成功删除后，同步删除客户端列表中的数据
                        store.load({params:{start:0, limit:18}});
                        Ext.Msg.alert('提示','删除网页query表记录信息成功。');
                    }else{
                        Ext.Msg.alert('提示','该网页query表记录已包含'+result.num+'本书籍信息不能删除！');
                    }
                },
                failure : function(response,options){
                    msgTip.hide();
                    Ext.Msg.alert('提示','删除网页query表记录请求失败！');
                }
            });
        }
        function checkData(){
            var ret=0,re,regStr,url_type;
            var url = document.getElementById("inputUrl").value;
            var type_arr = Ext.query("*[name=url_type]");
            for(var j=0;j<type_arr.length;j++){
                if(type_arr[j].checked){
                    url_type=type_arr[j].value;
                }
            }
            if(url_type==0)regStr = "^(https|http|ftp|rtsp|mms)(://)(.*)$";
            else if(url_type==1)regStr = "^([\\s\\S]+\\.)+([a-zA-Z/]{2,})$";
            else if(url_type==2)regStr = "^([\\s\\S]+\\.)+([a-zA-Z/]{2,})$";
            else if(url_type==3)regStr = "^((https|http|ftp|rtsp|mms)://)(.*)$";
            re = new RegExp(regStr);
            url = url.replace(/(^\s*)|(\s*$)/g, "").replace("\r","");
            var url_arr = url.split("\n");
            for(var i=0;i<url_arr.length;i++){
                var url_test = url_arr[i];
                if(!re.test(url_test))return parseInt(url_type)+1;
            }
            return 0;
        }
        //提交表单数据
        function submitForm(){
            //判断当前执行的提交操作，isAdd为true表示执行域名表记录新增操作，false表示执行域名表记录修改操作
            if( inputForm.form.isValid() ){
                
                //这里对数据的有效性进行检查，不合法的数据不进行入库操作。
                var ret=checkData();
                if(ret==1){
                    Ext.Msg.alert('提示','url应该以某个协议开头，如http://xxx,https://xxx');
                }else if(ret==2){
                    Ext.Msg.alert('提示','site格式不正确，格式如：[http://]www.sogou.com');
                }else if(ret==3){
                    Ext.Msg.alert('提示','domain格式不正确，格式如：sogou.com');
                }else if(ret==4){
                    Ext.Msg.alert('提示','prefix格式不正确，格式如：http://xxxxxx');             
                }else if(ret==0){ 
                    if(inputForm.isAdd){
                        //新增域名表记录信息
                        inputForm.form.submit({
                            clientValidation:true,//进行客户端验证
                            waitMsg : '正在提交数据请稍后',//提示信息
                            waitTitle : '提示',//标题
                            url : 'mingyi_blacklist.do?method=addRecord',//请求的url地址
                            method:'POST',//请求方式
                            success:function(form,action){//加载成功的处理函数
                                win.hide();
                                var failcause = action.result.cause;
                                var conflict = action.result.conflict;
                                Ext.MessageBox.show({
                                   title: '提示',
                                   msg: '完成新增网页query表记录操作。<br><br><br>' + failcause + '，包括如下记录：<br><textarea rows="10" cols="45" readonly="true">' + conflict + '</textarea>' , 
                                   buttons: Ext.MessageBox.OK,
                                   icon: Ext.MessageBox.INFO
                                });
                                store.load({params:{start:0, limit:18}});
                            },
                            failure:function(form,action){//加载失败的处理函数
                                win.hide();
                                var failcause = action.result.cause;
                                Ext.MessageBox.show({
                                   title: '提示',
                                   msg: '新增网页query表记录失败，原因是：<br>'+failcause,
                                   buttons: Ext.MessageBox.OK,
                                   icon: Ext.MessageBox.ERROR
                                });
                            }
                        });
                    }else{
                        //修改域名表记录信息
                        inputForm.form.submit({
                            clientValidation:true,//进行客户端验证
                            waitTitle : '提示',//标题
                            url : 'mingyi_blacklist.do?method=modifyRecord',//请求的url地址
                            method:'POST',//请求方式
                            success:function(form,action){//加载成功的处理函数
                                win.hide();
                                store.load({params:{start:0, limit:18}});
                                Ext.Msg.alert('提示','修改网页query表记录成功');
                            },
                            failure:function(form,action){//加载失败的处理函数
                                win.hide();
                                var failcause = action.result.cause;
                                Ext.MessageBox.show({
                                   title: '提示',
                                   msg: '修改网页query表记录失败。原因是:<br>'+failcause,
                                   buttons: Ext.MessageBox.OK,
                                   icon: Ext.MessageBox.ERROR
                                });
                            }
                        });
                    }
                }
            }//if( inputForm.form.isValid() )
            else{
                
            }
        }
        //取得所选域名记录信息
        function getCheckedIdList(){
            var recs = recordGrid.getSelectionModel().getSelections();
            var list = [];
            if(recs.length == 0){
                Ext.MessageBox.alert('提示','请选择要进行操作的记录！');
            }else{
                for(var i = 0 ; i < recs.length ; i++){
                    var rec = recs[i];
                    list.push(rec.get('id'));
                }
            }
            return list;
        }
        //将URL类型解析成 文本
        function urltype(val){
            if(val == 1){
                return 'Site';
            }else if(val == 0){
                return 'Url';
            }else if(val==2){
                return 'Domain';
            }else if(val==3){
                return 'Prefix';
            }else
                return '';
        }
        //导出Excel
        function exportExcel(){
            var msgTip = Ext.MessageBox.show({
                title:'提示',
                width : 250,
                msg:'正在导出网页query记录信息请稍候（上限1w条）......'
            });
            Ext.Ajax.request({
                url : 'mingyi_blacklist.do?method=exportRecord',
                params : {storeUrl : Ext.util.JSON.encode(exportConditionUrl) },
                method : 'POST',
                success : function(response,options){
                    msgTip.hide();
                    window.location = '<%=request.getContextPath()%>/exportExcel/blacklist_query.xls';
                    var result = Ext.util.JSON.decode(response.responseText);
                },
                failure : function(response,options){
                    msgTip.hide();
                    Ext.Msg.alert('提示','导出网页query记录请求失败！');
                }
            });
        }
        //开始查询代码
        function query(tag){
            //新增域名表记录信息
            var query_url ;
            if(tag)
                query_url = document.getElementById("query_url").value;
            else{
                query_url = '';
                document.getElementById("query_url").value='';
            }
            var query_matchType;
            if(document.getElementsByName("query_matchType")[0].checked)
                query_matchType = 1;
            else
                query_matchType = 0;
            

            var query_create_time_1 = document.getElementById("query_create_time_1").value;
            var query_create_time_2 = document.getElementById("query_create_time_2").value;
            var query_sub_user = document.getElementById("query_sub_user").value;
            
            var query_info = document.getElementById("query_info").value,query_info_type;
            if(document.getElementsByName("query_info_type")[0].checked){
                query_info_type = 1;
            }else{
                query_info_type = 0;
            }
            
            var query_url_type;
                       
            if(document.getElementsByName("query_url_type")[0].checked)
                query_url_type = -100;
            else if(document.getElementsByName("query_url_type")[1].checked)
                query_url_type = 0;
            else if(document.getElementsByName("query_url_type")[2].checked)
                query_url_type = 1;
            else if(document.getElementsByName("query_url_type")[3].checked)
                query_url_type = 2;
            else
                query_url_type = 3;

            
            var url = "mingyi_blacklist.do?method=getRecordList&query_url="+escape(query_url)+"&query_matchType="+query_matchType
            +"&query_create_time_1=" + query_create_time_1 + "&query_create_time_2=" + query_create_time_2
            + "&query_sub_user=" + escape(query_sub_user) + "&query_url_type=" + query_url_type+"&query_info="+escape(query_info)+"&query_info_type="+query_info_type;

            exportConditionUrl = "mingyi_blacklist.do?method=getRecordList&query_url="+query_url+"&query_matchType="+query_matchType
            +"&query_create_time_1=" + query_create_time_1 + "&query_create_time_2=" + query_create_time_2
            + "&query_sub_user=" + query_sub_user + "&query_url_type=" + query_url_type+"&query_info="+escape(query_info)+"&query_info_type="+query_info_type;
            
            store.proxy.conn.url = url;
            store.load({params:{start:0, limit:18}});
        }
        
        dr.render('dr');
        Ext.get('query_create_time_1').on('click',function(){
            WdatePicker({skin:'ext',dateFmt:'yyyy-MM-dd HH:mm:ss',maxDate:'#F{$dp.$D(\'query_create_time_2\')}'});
        });
        Ext.get('query_create_time_2').on('click',function(){
            WdatePicker({skin:'ext',dateFmt:'yyyy-MM-dd HH:mm:ss',minDate:'#F{$dp.$D(\'query_create_time_1\')}'});
        });
    });
</script>
<body>
<div id="dr" style="width:100%;height:30%;"></div>
<div id="progress-div" style="width:100%;height:4%;display:none"></div>
<div id='grid-div' style="width:100%; height:66%;"></div>
</body>
</html>